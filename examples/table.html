<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>big data table</title>
    <link rel="stylesheet" href="../build/Cells.css"/>
    <script src="../build/Cells.js"></script>
    <style>
        html,body{
            width:100%;
            height:100%;
            padding:0;
            margin:0;
            overflow:hidden;
        }
        #table{
            width:100%;
            height:80%;
        }
    </style>
    <script>
        function randomColor(){
            var r = parseInt(255 * Math.random()),
                g = parseInt(255 * Math.random()),
                b = parseInt(255 * Math.random());
            return 'rgb(' + r + ',' + g + ',' + b + ')';
        }
        var cellsModel = new CELL.CellsModel();
        var header = [];
        var colNum = 100;
        for(var i = 0; i< colNum;i++){
            header.push({name:'column' + i,width:'10%',style:{
                backgroundColor:randomColor()
            }});
        }
        var rows = [];
        for(var i = 0;i < 100;i++){
            rows.push((function(){
                var fields = [];
                for(var col = 0;col < colNum;col++){
                    fields.push({value:'cell-'+ i + '-' + col,style:{
                        'background-color':randomColor()
                    }});
                }
                return {
                    height:'10%',
                    fields:fields
                };
            })());
        }
        var maxRowIndex = i;
        cellsModel.header = {
            height:50,
            fields:header
        };
        cellsModel.rows = rows;
        var tableCell;
        function init(){
            tableCell = new CELL.Cells(cellsModel,{
                renderTo:'#table',
                rowResize:true,
                colResize:true,
                overflowY:false,
                enableCustomScroll:true
            });


            /*window.addEventListener('resize', function () {
                tableCell.executeFunctionDelay('windowResize',tableCell.paint)
            });*/

        }
        function render(){
            console.time('start-render');
            tableCell.render();
            console.timeEnd('start-render');

            tableCell.addEventListener('click', function (e) {
                console.log('click start');
                console.log(e);
                console.log('click end');
            })

            tableCell.addEventListener('cellClick', function (e) {
                console.log('cell click start');
                console.log(e);
                console.log('cell click end');
            });

            /*tableCell.addEventListener('scroll', function (e) {
                console.log(e.target);
            });*/

        }
        function refresh(){
            //cellsModel.refresh();
            tableCell.paint();
        }
        function appendData(){
            var rows = [];
            for(var i = maxRowIndex;i < maxRowIndex + 3;i++){
                rows.push((function(){
                    var fields = [];
                    for(var col = 0;col < colNum;col++){
                        fields.push({value:'cell-'+ i + '-' + col});
                    }
                    return {
                        height:300,
                        fields:fields
                    };
                })());
            }
            maxRowIndex = i;
            cellsModel.appendRows(rows);
        }
        function appendHtmlData(){
            var rows = [];
            console.time('---appendrow')
            for(var i = maxRowIndex;i < maxRowIndex + 1000;i++){

                rows.push((function(){
                    var fields = [];
                    for(var col = 0;col < colNum;col++){
                        fields.push({html:'<div style="position:absolute;top:10px;' +
                        'bottom:10px;left:15px;right:15px;background-color: red;padding: 5px;background-clip: content-box;border: 1px solid #dce;">' + '' +
                        '<img style="width:100%;height:100%" src="http://bpic.588ku.com/back_pic/04/71/07/88589a6c0791964.jpg!ww1200"/>' +
                        '' + '</div>'});
                    }
                    return {
                        height:300,
                        fields:fields
                    };
                })());

            }
            console.timeEnd('---appendrow')
            maxRowIndex = i;
            cellsModel.appendRows(rows);
        }

    </script>
</head>
<body onload="init()">
    <button onclick="render()">render</button>
    <button onclick="refresh()">refresh</button>
    <button onclick="appendData()">appendData</button>
    <button onclick="appendHtmlData()">appendHtmlData</button>
    <div id="table">

    </div>
</body>
</html>