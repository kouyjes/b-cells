<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>big data table</title>
    <link rel="stylesheet" href="../build/table.css"/>
    <script src="../build/table.js"></script>
    <style>
        html,body{
            width:100%;
            height:100%;
            padding:0;
            margin:0;
            overflow:hidden;
        }
        #table{
            width:100%;
            height:60%;
        }
    </style>
    <script>
        var tableModel = new CELL.TableModel();
        var header = [];
        var colNum = 20;
        for(var i = 0; i< colNum;i++){
            header.push({name:'column' + i,width:'23.3%'});
        }
        var rows = [];
        for(var i = 0;i < 100;i++){
            rows.push((function(){
                var fields = [];
                for(var col = 0;col < colNum;col++){
                    fields.push({value:'cell-'+ i + '-' + col});
                }
                return {
                    height:'10%',
                    fields:fields
                };
            })());
        }
        var maxRowIndex = i;
        tableModel.header = {
            height:50,
            fields:header
        };
        tableModel.rows = rows;

        function init(){
            var tableCell = new CELL.TableCell(tableModel,{
                rowResize:true,
                colResize:true
            });
            console.time('start-render');
            tableCell.render('#table');
            console.timeEnd('start-render');

            window.addEventListener('resize', function () {
                tableCell.paint();
                /*tableCell.executeFunctionDelay('resize', function () {
                    var scrollTo = tableCell.scrollTo();
                    tableCell.refresh();
                    tableCell.scrollTo(scrollTo.scrollTop,scrollTo.scrollLeft);
                });*/
            });

        }
        function refresh(){
            tableModel.refresh();
        }
        function appendData(){
            var rows = [];
            for(var i = maxRowIndex;i < maxRowIndex + 10;i++){
                rows.push((function(){
                    var fields = [];
                    for(var col = 0;col < colNum;col++){
                        fields.push({value:'cell-'+ i + '-' + col});
                    }
                    return {
                        height:i%5 * 30,
                        fields:fields
                    };
                })());
            }
            maxRowIndex = i;
            tableModel.appendRows(rows);
        }
        function appendHtmlData(){
            var rows = [];
            for(var i = maxRowIndex;i < maxRowIndex + 1000;i++){
                rows.push((function(){
                    var fields = [];
                    for(var col = 0;col < colNum;col++){
                        fields.push({html:'<div style="position:absolute;top:10px;' +
                        'bottom:10px;left:15px;right:15px;background-color: red;padding: 5px;background-clip: content-box;border: 1px solid #dce;">' + 'cell-'+ i + '-' + col + '</div>'});
                    }
                    return {
                        height:i%5 * 30,
                        fields:fields
                    };
                })());
            }
            maxRowIndex = i;
            tableModel.appendRows(rows);
        }

    </script>
</head>
<body>
    <button onclick="init()">render</button>
    <button onclick="refresh()">refresh</button>
    <button onclick="appendData()">appendData</button>
    <button onclick="appendHtmlData()">appendHtmlData</button>
    <div id="table">

    </div>
</body>
</html>